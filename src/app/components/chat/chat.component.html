<nb-layout rtl>
    <nb-layout-header>
        <div class="logo">
            <img src="../assets/logo-new.png" alt="">
        </div>
        <nb-icon icon="lock-outline" class="logout-icon" (click)="logout()"></nb-icon>
        <nb-icon icon="people-outline" class="people-icon" (click)="toConsole()" *ngIf="adminAccess"></nb-icon>
    </nb-layout-header>
    <nb-layout-column>

        <div class="chat-area">
            <div class="select-status" *ngIf="activeChat" nbButton [nbPopover]="popoverStatus"
                nbPopoverPlacement="bottom">
                {{activeChat.chatStatusId == 'new' ? 'חָדָשׁ' : ''}}
                {{activeChat.chatStatusId == 'active' ? 'פָּעִיל' : ''}}
                {{activeChat.chatStatusId == 'resolved' ? 'נפתרה' : ''}}
                {{activeChat.chatStatusId == 'archived' ? 'נשמר בארכיון' : ''}}
                <span [ngClass]="activeChat.chatStatusId"></span>
                <nb-icon icon="arrow-ios-downward-outline"></nb-icon>
            </div>
            <ng-template #popoverStatus NbPosition="bottom" class="popover-status">
                <div (click)="changeStatus('new')"><span class="new"></span>חָדָשׁ</div>
                <div (click)="changeStatus('active')"><span class="active"></span>פָּעִיל</div>
                <div (click)="changeStatus('resolved')"><span class="resolved"></span>נפתרה</div>
                <div (click)="changeStatus('archived')"><span class="archived"></span>נשמר בארכיון</div>
            </ng-template>
            <nb-chat scrollBottom="true" [title]="activeChat ? activeChat.name : ''">
                <nb-chat-message *ngFor="let message of messages.value" [message]="message.details"
                    [type]="message.type" [sender]="getUserById(message.userId) ? getUserById(message.userId).name : ''"
                    [files]="message.files" [reply]="message.userId == actualUserId" [date]="message.createdOn"
                    [dateFormat]="'medium'">
                </nb-chat-message>
                <nb-chat-form [message]="shareUrl" messagePlaceholder="הקלד הודעה" (send)="newMessage($event)"
                    [dropFiles]="true"></nb-chat-form>
            </nb-chat>
        </div>
    </nb-layout-column>
    <nb-layout-column class="notes-video-column">
        <nb-card class="notes">
            <app-notes-list [notes]="notes.value" [chatId]="activeChatId" (addNote)="newNote($event)"
                (deleteNote)="removeNote($event)"></app-notes-list>
        </nb-card>
        <app-video-chat [url]="roomUrlWithToken" (inviteUserToVideoChat)="putShareLink()"></app-video-chat>
    </nb-layout-column>
    <nb-layout-column start="true" class="chats-column">
        <div class="chats">
            <app-chat-rooms-llist [rooms]="chats.value" (roomChanged)="getRoomMesages($event)"
                (removeChat)="removeChat($event)" (filterStatus)="filterStatus($event)"></app-chat-rooms-llist>
        </div>
    </nb-layout-column>
</nb-layout>